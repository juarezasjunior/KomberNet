@page "/login"
@using KomberNet.UI.WEB.Client.Auth;
@using KomberNet.Models.Auth;

@inherits BasePage

@inject IAuthService authService;

<PageTitle>@this.Localizer["Login_PageTitle"]</PageTitle>

<RadzenRow JustifyContent="Radzen.JustifyContent.Center">
    <RadzenColumn SizeLG="4" SizeMD="5">
        <RadzenCard>
            <RadzenTemplateForm TItem="Login" Data="@this" Submit="async () => await this.LoginAsync()">
                <RadzenRow>
                    <RadzenColumn>
                        <RadzenStack>

                            <RadzenFormField Text="@this.Localizer["Login_Email"]">
                                <RadzenTextBox Name="@nameof(this.Email)" @bind-Value="Email" />
                                <RadzenRequiredValidator Component="@nameof(this.Email)" Text="@this.Localizer["Field_Required"]" />
                                <RadzenEmailValidator Component="@nameof(this.Email)" Text="@this.Localizer["Field_InvalidEmail"]" />
                            </RadzenFormField>

                            <RadzenFormField Text="@this.Localizer["Login_Password"]">
                                <RadzenPassword Name="@nameof(this.Password)" @bind-Value="Password" />
                                <RadzenRequiredValidator Component="@nameof(this.Password)" Text="@this.Localizer["Field_Required"]" />
                            </RadzenFormField>

                            <RadzenButton ButtonType="Radzen.ButtonType.Submit" Text="@this.Localizer["Login_Button"]" />

                            <RadzenStack Orientation="Radzen.Orientation.Horizontal" JustifyContent="Radzen.JustifyContent.Center">
                                <RadzenButton Text="@this.Localizer["Login_New"]" />
                                <RadzenButton Text="@this.Localizer["Login_ForgotPassword_Button"]" />
                            </RadzenStack>

                        </RadzenStack>
                    </RadzenColumn>
                </RadzenRow>
            </RadzenTemplateForm>
        </RadzenCard>
    </RadzenColumn>
</RadzenRow>

@code {
    private string FullName { get; set; }

    private string Email { get; set; }

    private string Password { get; set; }

    private async Task LoginAsync()
    {
        await this.authService.InsertUserAsync(new UserInsertRequest()
        {
            FullName = this.Email,
            Email = this.Email,
            Password = this.Password,
        });

        var result = await this.authService.LoginAsync(new LoginRequest()
            {
                Email = this.Email,
                Password = this.Password,
            });

        await this.authService.LogoutAsync();
    }
}
